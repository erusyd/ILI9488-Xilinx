# ILI9488 library on MicroBlaze (AXI GPIO, AXI SPI, DDR3 SDRAM)

:construction::construction::construction::construction: **THIS IS WORK IN PROGRESS** :construction::construction::construction::construction:

This folder contains a sample project for using the [ILI9488 library](https://github.com/viktor-nikolov/ILI9488-Xilinx) on the [MicroBlaze](https://www.xilinx.com/products/design-tools/microblaze.html) soft CPU using DD3 SDRAM.

The design was made in Vivado 2023.1 and Vitis 2023.1 and tested on [Arty A7-35T](https://digilent.com/shop/arty-a7-100t-artix-7-fpga-development-board/) (this variant 35T  is no longer in production).

> [!IMPORTANT]
> **If you have Arty A7-100T**, you must change the board to A7-100T in Vivado in Tools|Settings|General|Project device.  
> No other changes in the design should be necessary.
>
> Generate the bitstream and export HW ((File|Export|Export Hardware, select "Include Bitstream").  
> Then, in Vitis, you right-click the "system" project in the Explorer, select "Update Hardware Specification" and specify the .xsa file generated by Vivado. With the HW specification updated, you must re-build all projects in the Vitis workspace.

## HW design

I selected Pmod JD on the Arty A7 to connect the display. JD is a so-called standard Pmod (see details in the Arty A7 [Reference Manual](https://digilent.com/reference/programmable-logic/arty-a7/reference-manual?redirect=1#pmod_connectors)).



... RST and DC signals.  
The two Slices are used solely for "aesthetic purposes", so the RST and DC pins can be scalar pins in the diagram.

Input ext_spi_clk of the AXI SPI IP is fed with a 40 MHz clock signal from the Clocking Wizzard. The Frequency Ratio of the AXI SPI IP is set to 2. This results in a 20 MHz SPI clock for the display.

[<img src="https://github.com/viktor-nikolov/ILI9488-Xilinx/blob/main/pictures/MicroBlaze_DDR3_AXI-GPIO_AXI-SPI_diagram.png?raw=true" title="" alt="">](https://github.com/viktor-nikolov/ILI9488-Xilinx/blob/main/pictures/MicroBlaze_DDR3_AXI-GPIO_AXI-SPI_diagram.png)

## Application setup in Vitis

In the C/C++ Build Settings, I set Optimization to "Optimize most (-O3)". The default optimization setting was -O2.

We have 256 MB of DDR3 SDRAM at our disposal, so I increased the Stack Size from the default 1 kB to 16 kB and the Heap Size from the default 2 kB to 32 kB.

Increasing the Stack Size is important.  

## Physical connection

[<img src="https://github.com/viktor-nikolov/ILI9488-Xilinx/blob/main/pictures/ArtyA7_connection_schematics.png?raw=true" title="" alt="" width="600">](https://github.com/viktor-nikolov/ILI9488-Xilinx/blob/main/pictures/ArtyA7_connection_schematics.png)

[<img src="https://github.com/viktor-nikolov/ILI9488-Xilinx/blob/main/pictures/ILI9488_with_Arty_A7.jpg?raw=true" title="" alt="" width="600">](https://github.com/viktor-nikolov/ILI9488-Xilinx/blob/main/pictures/ILI9488_with_Arty_A7.jpg)

